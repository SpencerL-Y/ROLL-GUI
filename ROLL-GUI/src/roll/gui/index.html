<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>ROLL LOCAL GUI</title>
<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" >

<script src="js/jquery-3.1.1.min.js"></script>
<script src="js/bootstrap.min.js"></script>

<script src="plugins/ace-builds-master/src-noconflict/ace.js" type="text/javascript"></script>
<style>

    body {
        padding-top: 70px;
    }
    button {
        -webkit-app-region : no-drag;
    }
    nav {
        -webkit-user-select: none;
        -webkit-app-region : drag;
    }
	.marpad{
		margin:10px;
		padding:5px;
	}
	.mar{
		margin:10px;
	}
	.pad{
		padding:10px;
	}
	.largefont{
		font-size:24px;
	}
	.midiumfont{
		font-size:18px;
	}
	.state{
		fill:white;
		stroke:black;
		stroke-width:2;
	}
	.transition{
		stroke:black;
		stroke-width:2;
	}
	.label{
		font:"Times New Roman", Times, serif;
		font-size:10px;
	}
</style>

</head>


<body>
<script src="js/bootstrap.min.js"></script>
<script src="js/jquery-3.1.1.min.js"></script>



<!-- The Navigation Bar with btns and dropdowns -->
	
	<nav class="navbar navbar-inverse navbar-fixed-top">
    	<div class="container-fluid">
       	  <a class="navbar-brand" href="#">ROLL</a>
            <ul class="nav navbar-nav">
            <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown"  href="#">Drop<span class="caret"></span></a>
                <ul class="dropdown-menu">
					<li><a href="#">link</a></li>
     				<li><a href="#">link</a></li>
					<li><a href="#">link</a></li>
				</ul>
            </li>
            <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Drop<span class="caret"></span></a>
                <ul class="dropdown-menu">
					<li><a href="#">link</a></li>
     				<li><a href="#">link</a></li>
					<li><a href="#">link</a></li>
				</ul>
            </li>
            <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown"  href="#">Drop<span class="caret"></span></a>
                <ul class="dropdown-menu">
					<li><a href="#">link</a></li>
     				<li><a href="#">link</a></li>
					<li><a href="#">link</a></li>
				</ul>
            </li>
            <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown"  href="#">Drop<span class="caret"></span></a>
                <ul class="dropdown-menu">
					<li><a href="#">link</a></li>
     				<li><a href="#">link</a></li>
					<li><a href="#">link</a></li>
				</ul>
            </li>
            <li class="pull-right"><a href="#">btn</a></li>
            <li><a href="#">btn</a></li>
            <li><a href="#">btn</a></li>
            </ul>
            <form class="navbar-form navbar-right">
                <button  class="btn btn-invers" onclick="app.callback('What ever you wish');">
                    <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                    <!-- Exit -->
                </button>
            </form>
            
      </div>
</nav>

<!-- Tab to choose mode-->
<div class="container-fluid text-center">
	<ul class="nav nav-tabs">
        <li class=" active" id="IM" onClick="IMActive()"><a href="#">Interactive Mode</a></li>
        <li id="AM" onClick="AMActive();"><a href="#">Automatic Mode</a></li>
	</ul>
</div>

<!--interactive mode-->
<div id="interactive">
	<div class="container">
        <h3>Information for interactive learning :</h3>
            <div class="form-group">
				<div class="row" style="height:10px"></div>
				<div class="row">
                    <label class="col-md-2 control-label">Number of letters</label>
                    <div class="col-md-10">
						<input class="form-control" id="alphaNum" type="text" >
                    </div>
				</div>	
				<div class="row" style="height:10px"></div>
                <div class="row">
                    <label class="col-md-2 control-label">Alphabet</label>
                    <div class="col-md-10">
						<input class="form-control" id="alphabet" type="text" >
                    </div>
				</div>	
				<div class="row" style="height:10px"></div>
				<div class="row">
                    <label class="col-md-2 control-label">Data Structure</label>
                    <div class="col-md-10">
						<div class="col-md-2">
							<input id="table" type="radio" name="dataStructure" value="Table" /> Table
						</div>
						<div class="col-md-2">
							<input id="tree" type="radio" name="dataStructure" value="Tree" /> Tree
						</div>
                    </div>
				</div>

				<div class="row">
					<label class="col-md-2 control-label">Algorithm</label>
					<div class="col-md-10">
						<div class="col-md-2">
							<input id="periodic" type="radio" name="algorithm" value="Periodic" /> Periodic
						</div>
						<div class="col-md-2">
							<input id="syntactic" type="radio" name="algorithm" value="Syntactic"/> Syntactic
						</div>
						<div class="col-md-2">
							<input id="recurrent" type="radio" name="algorithm" value="Recurrent" /> Recurrent
						</div>
						<div class="col-md-2">
							<input id="ldollar" type="radio" name="algorithm" value="LDollar"/> LDollar
						</div>
					</div> 
				</div>

				<div class="row">
					<label class="col-md-2 control-label">Approach Method</label>
					<div class="col-md-10">
						<div class="col-md-2">
							<input id="under" type="radio" name="approach" value="Under" /> Under
						</div>
						<div class="col-md-2">
							<input id="over" type="radio" name="approach" value="Over"/> Over
						</div>
					</div> 
				</div>
				
				<div class="row">
					<div class="col-md-2"></div>
					<div class="col-md-10">
						<button id="submitAlpha" class="btn-block btn btn-primary" style="margin-top:10px;" onclick="startPlaying();" >Submit</button>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-md-2"></div>
				<div class="col-md-10">
					<h4 id="infoStatus" style="text-align:center; font-family:Courier New, Courier, monospace">Currently Nothing</h4>
				</div>
				<div class="col-md-2"></div>
			</div>
			<h3>Interaction :</h3>
            <div class="row">
				<div class="form-group">
					<label for="MQuery" class="col-md-2 control-label">MembershipQuery &nbsp;<span class="badge" id="memNum">0</span></label>
					<div class="col-md-10">
						<input type="text" id="memQuery" class="form-control" placeholder="MQ">
					</div>
				</div>
			</div>
			
            <div class="row">
				<div class="form-group">
					<label class="col-md-2 control-label">Run Accepted?</label>
					<div class="col-md-5">
						<button class=" btn-block btn btn-primary" id="MQButtonY" style="margin-top:10px; margin-bottom:10px;" onclick="answerMembershipQuery(true);">Yes</button>
					</div>
					<div class="col-md-5">
						<button class=" btn-block btn btn-primary" id="MQButtonN" style="margin-top:10px; margin-bottom:10px;" onclick="answerMembershipQuery(false);">No</button>
					</div>
				</div>
			</div>

			<div class="row">
				<div class="form-group">
					<label for="EQuery" class="col-md-2 control-label">EquivalenceQuery &nbsp;<span class="badge" id="equiNum">0</span></label>
					<div class="col-md-10">
						<textarea type="text" id="equiQuery" class="form-control" placeholder="EQ" rows="15"></textarea>
					</div>
				</div>
			</div>

			<div class="row">
				<div class="form-group">
					<label for="EQuery" class="col-md-2 control-label">EQ Pic</label>
					<div class="col-md-10">
						<div id="displayArea"></div>
					</div>
				</div>
			</div>

			<div class="row" style="height:10px"></div>
			<div class="row">
				<div class="col-md-2">
					<label class="control-label">CE stem: </label>
				</div>
                <div class="col-md-4">
					<input class="form-control" id="counterExampleStem" type="text" >
				</div>
			</div>
			<div style="height:10px"></div>
			<div class="row">
				<div class="col-md-2">
						<label class="control-label">CE loop:</label>
				</div>
				<div class="col-md-4">
					<input class="form-control" id="counterExampleLoop" type="text" >
				</div>
			</div>

            <div class="row">
				<div class="form-group">
					<label class="col-md-2 control-label">Correct Result?</label>
					<div class="col-md-5">
						<button class=" btn-block btn btn-primary" id="EQButtonY" style="margin-top:10px; margin-bottom:10px;" onclick="answerEquivalenceQuery(true);">Yes</button>
					</div>
					<div class="col-md-5">
						<button class=" btn-block btn btn-primary" id="EQButtonN" style="margin-top:10px; margin-bottom:10px;" onclick="answerEquivalenceQuery(false);">No</button>
					</div>
				</div>
			</div>
		</div>
	</div>

<!--automatic mode-->
	<div id="automatic" class="container" hidden="hidden">
		<div class="marpad">
			<h2 class="marpad">Automatic Learning</h2>
			<p class="marpad">Input your automata in BA format and the learning process will be executed automaticly. </p>
		</div>
		<div class="row">
    		<div class="col-md-6">
        		<div class="marpad" id="out"> 
            		<label class="pad  midiumfont">Automata Input :</label>
					<button class="btn pull-right btn-primary mar" style="width:30%;margin-bottom" id="autoRun">Run</button>
					<pre id="editor" class="mar" style="height:600px;"></pre>
                </div>
			</div> 
		
        	<div class="col-md-6">
        		<div class="marpad">
            	<label class="pad midiumfont">Result :</label>
                <div>
					<pre id="result" class="mar" style=" height:600px; "></pre>
                </div>
            </div>
		</div>
    </div>	
</div>




<!--script for styles-->
<script>
"use strict";
	
	//effect for the navigation bar
	function IMActive(){
		document.getElementById('IM').className='active';
		document.getElementById('AM').className='';
		document.getElementById('automatic').hidden = "hidden";
		document.getElementById('interactive').hidden = "";
		
	}
	function AMActive(){
		document.getElementById('AM').className='active';
		document.getElementById('IM').className='';
		document.getElementById('automatic').hidden = "";
		document.getElementById('interactive').hidden = "hidden";
		
	}
	//ace editor
	var editor = ace.edit("editor");
   	editor.setTheme("ace/theme/twilight");

	
</script>


<script src="plugins/ace-builds-master/src-noconflict/ace.js" type="text/javascript"></script>
<script src="js/d3.js"></script>
<script src="./viz.js"></script>
<script>
    
document.getElementById("displayArea").innerHTML = Viz("digraph { a -> b; }");
    
</script>

<script>
	"use strict";
	function sleep(numberMillis) {    
		var now = new Date();    
		var exitTime = now.getTime() + numberMillis;   
		while (true) { 
			now = new Date();       
			if (now.getTime() > exitTime) 
			return;    
		} 
	}
	
	function textBlink(){
		for(var i = 0; i < 6; i++){
			if(i%2 == 0){
				document.getElementById("infoStatus").style.color = "black";
				sleep(300);
			} else {
				document.getElementById("infoStatus").style.color = "red";
				sleep(300);
			}
		}
		
	}


</script>


<!--script for interaction-->
<script type="text/javascript">
	"use strict";
	document.getElementById("alphaNum").value = "2";
	document.getElementById("alphabet").value = "a, b";
   	document.getElementById("table").checked = true;
	document.getElementById("periodic").checked = true;
	document.getElementById("under").checked = true;
	document.getElementById("MQButtonY").disabled = "disabled";
	document.getElementById("MQButtonN").disabled = "disabled";
	document.getElementById("EQButtonY").disabled = "disabled";
	document.getElementById("EQButtonN").disabled = "disabled";
	document.getElementById("submitAlpha").disabled = "";
	var memNum = 0;
	var equiNum = 0;
	var illegalInput = 0;

	/*-----------------------Interactive Learning-------------------------*/	
	function startPlaying(){
		document.getElementById("equiQuery").value = "";
		document.getElementById("memQuery").value= "";
		document.getElementById("submitAlpha").disabled = "disabled";
		//get alphabet
		var alphaNum = document.getElementById("alphaNum").value;
		var alphabet = checkAlphabet();
		if(alphabet == null){
			return null;
		}
		//get data structure
		var dataStructure = "table";
		if(document.getElementById("tree").checked){
			dataStructure = "tree";
		} else if(document.getElementById("table").checked){
			dataStructure = "table";
		} else {
			dataStructure = "error";
		}
	
		//get algorithm 
		var algorithm = "periodic";
		if(document.getElementById("periodic").checked){
			algorithm = "periodic";
		} else if(document.getElementById("syntactic").checked) {
			algorithm = "syntactic";
		} else if(document.getElementById("recurrent").checked) {
			algorithm = "recurrent";
		} else if(document.getElementById("ldollar").checked){
			algorithm = "ldollar";
		} else {
			algorithm = "error";
		}
	
		//get approach method
		var approach = "under";
		if(document.getElementById("under").checked){
			approach = "under";
		} else if(document.getElementById("over").checked){
			approach = "over";
		} else {
			approach = "error";
		}
	
	
		document.getElementById("equiNum").innerHTML = "0" ;
		document.getElementById("memNum").innerHTML = "0" ;
		equiNum = 0;
		memNum = 0;
		var returnedValue = app.submitOptions(alphaNum, alphabet, dataStructure, algorithm, approach);
		document.getElementById("infoStatus").innerHTML = returnedValue;
		placeReturnedValue(returnedValue);
	}
	
	function answerMembershipQuery(answer){
		var nextStr = "next";
		
		if(answer == true){
			nextStr = app.answerMem(1);
		} else {
			nextStr = app.answerMem(0);
		}
		document.getElementById("MQButtonY").disabled = "disabled";
		document.getElementById("MQButtonN").disabled = "disabled";
		document.getElementById("infoStatus").innerHTML = nextStr;
		placeReturnedValue(nextStr);
		return nextStr;
	}

	function answerEquivalenceQuery(answer){
		var nextStr = "next";
		if(answer == true){
			app.answerEqui(1, null);
			nextStr = "Interactive Learning Complished";
			document.getElementById("submitAlpha").disabled = "";
			document.getElementById("EQButtonY").disabled = "disabled";
			document.getElementById("EQButtonN").disabled = "disabled";
			document.getElementById("infoStatus").innerHTML = "Learning Procedure finished";
			app.terminate();
		} else {
			if(illegalInput){
				nextStr = app.answerEquiAgain(document.getElementById("counterExampleStem").value + "," + document.getElementById("counterExampleLoop").value);
			} else {
				nextStr = app.answerEqui(0, document.getElementById("counterExampleStem").value + "," + document.getElementById("counterExampleLoop").value);
			}
			document.getElementById("EQButtonY").disabled = "disabled";
			document.getElementById("EQButtonN").disabled = "disabled";
			document.getElementById("counterExampleLoop").value = "";
			document.getElementById("counterExampleStem").value = "";
			document.getElementById("infoStatus").innerHTML = "EquiAns over";
			placeReturnedValue(nextStr);
		}
		
		return nextStr;
	}

	function placeReturnedValue(src){
		
		document.getElementById("infoStatus").innerHTML = "Place: next string is " + src;
		if(src[0]=='E'){
			illegalInput = 0;
			document.getElementById("EQButtonY").disabled = "";
			document.getElementById("EQButtonN").disabled = "";
			document.getElementById("infoStatus").innerHTML = "Please answer Equivalence Query";
			document.getElementById("equiQuery").value = src;
			equiNum += 1;
			document.getElementById("equiNum").innerHTML = equiNum;
			
			return 'E';
		} else if(src[0] == 'S'){
			illegalInput = 0;
			var appendStr;
			document.getElementById("infoStatus").innerHTML = "Synchronize Equivalence Query";
			appendStr = app.equiSyncAck();
			var e = placeReturnedValue(appendStr);
			assert(e == 'E');
			return 'S';
		} else if(src[0] == 'M'){
			illegalInput = 0;
			document.getElementById("MQButtonY").disabled = "";
			document.getElementById("MQButtonN").disabled = "";
			document.getElementById("memQuery").innerHTML = src;
			document.getElementById("infoStatus").innerHTML = "Please answer Membership Query";
			document.getElementById("memQuery").value = src.slice(2);
			memNum += 1;
			document.getElementById("memNum").innerHTML = memNum;
			return 'M';
		} else if(src[0] == 'F'){
			illegalInput = 0;
			document.getElementById("infoStatus").innerHTML = "Learning Procedure finished";
			return 'F';
		} else if(src[0] == "I"){
			illegalInput = 1;
			document.getElementById("EQButtonY").disabled = "disabled";
			document.getElementById("EQButtonN").disabled = "";
			document.getElementById("infoStatus").innerHTML = "Counterexample format error! Please answer EQ again!";
			document.getElementById("counterExampleLoop").value = "";
			document.getElementById("counterExampleStem").value = "";
			return 'I';
		}
	}

	function checkAlphabet(){
		var alpha = document.getElementById("alphabet").value.toLowerCase();
		var alphaNum = document.getElementById("alphaNum").value;
		var alphaArray = alpha.split(",");
		var returnStr = "";
		if(alphaArray.length == alphaNum && alphaNum != 0){
			var array = new Array(26);
			for(var i = 0; i < alphaNum; i ++){
				var char = alphaArray[i].trim().charAt(0);
				var letterIndex = char.charCodeAt() - 91;
				if(array[letterIndex] == true && char >= 'a' && char <= 'z'){
					document.getElementById("infoStatus").innerHTML = "ERROR: Alphabet format is wrong, please input again. Same letter: " + letterIndex + " " + char;
					//textBlink();
					return null;
				} else {
					array[letterIndex] = true;
					returnStr += char;
				}
			}
		} else {
			document.getElementById("infoStatus").innerHTML = "ERROR: Alphabet size is wrong, please input again. Size: " + alphaNum;
			//textBlink();
			return null;
		}
		return returnStr;
	}
	/*-----------------------Automatic Learning-------------------------*/
	function startLearning(){
		
	}

	


			
	</script>
	
</body>

</html>
